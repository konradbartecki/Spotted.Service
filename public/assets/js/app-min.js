"use strict";var ApplicationConfiguration=function(){var e="spotted",o=["ui.router","angular-jwt","ngFileUpload","ui.bootstrap","angular-bootstrap-select","angularMoment"],t=function(o,t){angular.module(o,t||[]),angular.module(e).requires.push(o),angular.module(o).config(["$httpProvider",function(e){e.defaults.headers.get||(e.defaults.headers.get={}),e.defaults.headers.get["If-Modified-Since"]="Mon, 26 Jul 1997 05:00:00 GMT",e.defaults.headers.get["Cache-Control"]="no-cache",e.defaults.headers.get.Pragma="no-cache"}])};return{applicationModuleName:e,applicationModuleVendorDependencies:o,registerModule:t}}();angular.module(ApplicationConfiguration.applicationModuleName,ApplicationConfiguration.applicationModuleVendorDependencies),angular.module(ApplicationConfiguration.applicationModuleName).config(["$locationProvider",function(e){e.html5Mode(!0).hashPrefix("!")}]).run(function(e){e.changeLocale("pl")}).constant("angularMomentConfig",{timezone:"Europe/Warsaw"}),angular.element(document).ready(function(){"#_=_"===window.location.hash&&(window.location.hash="#!"),angular.bootstrap(document,[ApplicationConfiguration.applicationModuleName])}),angular.module(ApplicationConfiguration.applicationModuleName).config(function(e,o){o.tokenGetter=function(){return localStorage.getItem("token")},e.interceptors.push("jwtInterceptor")}).run(function(e,o,t,n,a){o.$on("$stateChangeStart",function(o,n){n.access&&n.access.guest?t.localStorage.getItem("token")&&(o.preventDefault(),e.go("posts")):n.access&&n.access.user&&(t.localStorage.getItem("token")||(o.preventDefault(),e.go("home"),a.open({animation:!1,templateUrl:"app/modules/users/client/views/authentication/signin/signin.client.view.html",controller:"authController",size:"lg"})))}),o.user=!1,o.$on("$stateChangeStart",function(){var e=t.localStorage.getItem("token");if(e){var a=e&&n.decodeToken(e);o.user=a.user}})}),ApplicationConfiguration.registerModule("comments"),ApplicationConfiguration.registerModule("core"),ApplicationConfiguration.registerModule("posts"),ApplicationConfiguration.registerModule("users"),angular.module("comments").factory("commentsFactory",function(){return{api:{comments:"api/v1/comments"}}}),angular.module("posts").factory("postsFactory",function(){return{api:{posts:"api/v1/posts",postGroup:"api/v1/posts/groups",groups:"api/v1/groups"}}}),angular.module("users").factory("usersFactory",function(){return{api:{login:"api/v1/auth/signin",register:"api/v1/auth/signup"},messages:{error:{unknown:"Coś poszło nie tak. Spróbuj ponownie!",conflict:"Wprowadzone dane są niepoprawne. Spróbuj ponownie.",emailExists:"Podany adres e-mail jest już zajęty!"}}}}),angular.module("core").config(["$stateProvider",function(e){e.state("home",{url:"/",templateUrl:"app/modules/core/client/views/home/home.client.view.html",access:{guest:!0,user:!1}})}]),angular.module("posts").config(["$stateProvider",function(e){e.state("posts",{url:"/posts",templateUrl:"app/modules/posts/client/views/posts.client.view.html",access:{guest:!1,user:!0}})}]),angular.module("comments").controller("commentsController",["$scope","$rootScope","commentsFactory",function(e,o,t){e.user=o.user.id,e.api=t.api,console.log(e.user)}]).controller("commentsCreateController",["$scope","$http",function(e,o){e.comment={},e.createComment=function(t){o({url:e.api.comments,method:"POST",data:{message:e.comment.message,user:e.user,post:t},headers:{"x-access-token":e.token}}).then(function(){e.comment={}})}}]),angular.module("core").controller("coreController",["$scope","$state",function(e,o){e.state=o,e.$watch("state.current.name",function(o){e.currentState=o,"home"==e.currentState?e.isHome=!0:e.isHome=!1})}]).controller("headerController",["$scope","$state","$window","$rootScope","$uibModal",function(e,o,t,n,a){e.signout=function(){t.localStorage.removeItem("token"),n.user=!1,o.go("home")},e.openModalAuth=function(e){a.open({animation:!1,templateUrl:"app/modules/users/client/views/authentication/"+e+"/"+e+".client.view.html",controller:"authController",size:"lg"})}}]),angular.module("users").controller("authController",["$scope","$uibModalInstance","$uibModal",function(e,o,t){e.closeModal=function(){o.dismiss("cancel")},e.switchModal=function(o){e.closeModal(),t.open({animation:!1,templateUrl:"app/modules/users/client/views/authentication/"+o+"/"+o+".client.view.html",controller:"authController",size:"lg"})}}]).controller("signinController",["$scope","$http","usersFactory","$window","$state",function(e,o,t,n,a){e.message={},e.signin=function(){o({url:t.api.login,method:"POST",data:e.user}).then(function(o){n.localStorage.setItem("token",o.data.token),e.closeModal(),a.go("posts")},function(o){var n=o.status;400==n?e.message.error=t.messages.error.unknown:401==n&&(e.message.error=t.messages.error.conflict)})}}]).controller("signupController",["$scope","$http","usersFactory","$uibModal",function(e,o,t,n){e.message={},e.signup=function(){o({url:t.api.register,method:"POST",data:e.user}).then(function(){e.closeModal(),n.open({animation:!1,templateUrl:"app/modules/users/client/views/authentication/signin/signin.client.view.html",controller:"authController",size:"lg"})},function(o){var n=o.status;400==n||500==n?e.message.error=t.messages.error.unknown:409==n&&(e.message.error=t.messages.error.emailExists)})}}]),angular.module("posts").controller("postsController",["$scope","$http","$rootScope","$window","postsFactory",function(e,o,t,n,a){e.user=t.user,e.token=n.localStorage.getItem("token"),e.api=a.api}]).controller("postsCreateController",["$scope","$http","Upload","$state",function(e,o,t,n){e.post={user:e.user.id,image:null},e.getGroups=function(){o({url:e.api.groups,method:"GET",headers:{"x-access-token":e.token}}).then(function(o){e.groups=o.data})},e.createPost=function(){null==e.post.image?o({url:e.api.posts,method:"POST",data:e.post,headers:{"x-access-token":e.token}}).then(function(){n.reload()}):e.createPostUpload(e.post)},e.createPostUpload=function(o){t.upload({url:e.api.posts,data:{description:o.description,image:o.image,group:o.group,user:o.user},headers:{"x-access-token":e.token}}).then(function(){n.reload()})}}]).controller("postsListController",["$scope","$http",function(e,o){e.commentsIsCollapsed=!0,e.getPosts=function(){o({url:e.api.posts,method:"GET",headers:{"x-access-token":e.token}}).then(function(o){e.posts=o.data,o.data.forEach(function(o,t){e.posts[t].number=t})})},e.getPostAuthor=function(t,n){o({url:e.api.posts+"/"+t+"/author",method:"GET",headers:{"x-access-token":e.token}}).then(function(o){e.posts[n].authorDetails=o.data})},e.getPostGroup=function(t,n){o({url:e.api.posts+"/"+t+"/group",method:"GET",headers:{"x-access-token":e.token}}).then(function(o){e.posts[n].groupDetails=o.data})}}]);