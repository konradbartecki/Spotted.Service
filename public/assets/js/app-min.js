"use strict";var ApplicationConfiguration=function(){var e="spotted",t=["ui.router","angular-loading-bar","ngAnimate","angular-jwt","ngFileUpload","ui.bootstrap","angular-bootstrap-select","angularMoment","ngTagsInput"],o=function(t,o){angular.module(t,o||[]),angular.module(e).requires.push(t),angular.module(t).config(["$httpProvider",function(e){e.defaults.headers.get||(e.defaults.headers.get={}),e.defaults.headers.get["If-Modified-Since"]="Mon, 26 Jul 1997 05:00:00 GMT",e.defaults.headers.get["Cache-Control"]="no-cache",e.defaults.headers.get.Pragma="no-cache"}])};return{applicationModuleName:e,applicationModuleVendorDependencies:t,registerModule:o}}();angular.module(ApplicationConfiguration.applicationModuleName,ApplicationConfiguration.applicationModuleVendorDependencies),angular.element(document).ready(function(){"#_=_"===window.location.hash&&(window.location.hash="#!"),angular.bootstrap(document,[ApplicationConfiguration.applicationModuleName])}),angular.module(ApplicationConfiguration.applicationModuleName).config(["$locationProvider","$httpProvider","jwtInterceptorProvider","cfpLoadingBarProvider",function(e,t,o,n){e.html5Mode(!0).hashPrefix("!"),o.tokenGetter=function(){return localStorage.getItem("token")},t.interceptors.push("jwtInterceptor"),n.includeSpinner=!1}]),angular.module(ApplicationConfiguration.applicationModuleName).run(function(e,t,o,n,r,s){r.changeLocale("pl"),o.$state=t,o.$on("$stateChangeStart",function(o,n){n.access&&n.access.guest?e.localStorage.getItem("token")&&(o.preventDefault(),t.go("home")):n.access&&n.access.user&&(e.localStorage.getItem("token")||(o.preventDefault(),t.go("auth.signin")))}),o.user=!1,o.$on("$stateChangeStart",function(){var t=e.localStorage.getItem("token");if(t){var n=t&&s.decodeToken(t);o.token=t,o.user=n.user}}),o.alerts=!1,o.$watch("alerts",function(e){e&&n(function(){o.alerts=!1},3e3)})});var ApiURL="api/v1";angular.module(ApplicationConfiguration.applicationModuleName).constant("API",{auth:{signIn:ApiURL+"/auth/signin",signUp:ApiURL+"/auth/signup"},users:ApiURL+"/users",groups:ApiURL+"/groups",posts:ApiURL+"/posts"}),ApplicationConfiguration.registerModule("core"),ApplicationConfiguration.registerModule("groups"),ApplicationConfiguration.registerModule("users"),ApplicationConfiguration.registerModule("posts"),angular.module(ApplicationConfiguration.applicationModuleName).directive("ngCompare",function(){return{require:"ngModel",scope:{otherModelValue:"=ngCompare"},link:function(e,t,o,n){n.$validators.ngCompare=function(t){return t==e.otherModelValue},e.$watch("otherModelValue",function(){n.$validate()})}}}).directive("ngClickAnyWhere",function(e){return{restrict:"A",link:function(t,o,n,r){o.bind("click",function(e){e.stopPropagation()}),e.bind("click",function(){t.$apply(n.ngClickAnyWhere)})}}}),angular.module(ApplicationConfiguration.applicationModuleName).factory("ALERT_SERVICE",function(e){var t={};return t.push=function(t,o){switch(t){case"success":e.alerts={success:o};break;case"error":e.alerts={error:o}}},t}),angular.module("posts").factory("COMMENT_SERVICE",function(e,t,o,n){return{getComments:function(o){return e.get(t.posts+"/"+o+"/comments").then(function(e){return e.data})},createComment:function(r,s){return e({url:t.posts+"/"+r+"/comments",method:"POST",data:{message:s.message,author:o.user.id},headers:{"x-access-token":o.token}}).then(function(){n.createCommentSuccess()},function(){n.createCommentFailed()})},deleteComment:function(r){return e({url:t.posts+"/comments/"+r,method:"DELETE",headers:{"x-access-token":o.token}}).then(function(){n.deleteCommentSuccess()},function(){n.deleteCommentFailed()})}}}).factory("COMMENT_EVENTS",function(e){return{createCommentSuccess:function(){e.push("success","Twój komentarz został pomyślnie dodany!")},createCommentFailed:function(){e.push("error","Coś poszło nie tak. Spróbuj ponownie!")},deleteCommentSuccess:function(){e.push("success","Twój komentarz został pomyślnie usunięty!")},deleteCommentFailed:function(){e.push("error","Coś poszło nie tak. Spróbuj ponownie!")}}}),angular.module("posts").factory("POST_SERVICE",function(e,t,o,n,r){return{getPosts:function(){return e.get(t.posts).then(function(e){return e.data})},getGroupsByName:function(o){return e.get(t.groups+"/"+o).then(function(e){return e.data})},createPost:function(n){return e({url:t.posts,method:"POST",data:{message:n.message,group:n.group[0]._id,author:o.user.id},headers:{"x-access-token":o.token}}).then(function(){r.createPostSuccess()},function(e){r.createPostFailed(),console.log(e)})},createPostUpload:function(e){return n.upload({url:t.posts,data:{message:e.message,image:e.picture,group:e.group[0]._id,author:o.user.id},headers:{"x-access-token":o.token}}).then(function(){r.createPostSuccess()},function(){r.createPostFailed()})}}}).factory("POST_EVENTS",function(e){return{createPostSuccess:function(){e.push("success","Ogłoszenie zostało pomyślnie dodane.")},createPostFailed:function(){e.push("error","Coś poszło nie tak. Spróbuj ponownie!")}}}),angular.module("groups").factory("GROUP_SERVICE",function(e,t,o,n){return{getGroups:function(){return e.get(t.groups).then(function(e){return e.data})},joinToGroup:function(r){return e({url:t.users+"/"+o.user.id+"/group",method:"POST",data:{group:{id:r}},headers:{"x-access-token":o.token}}).then(function(){n.joinToGroupSuccess()},function(){n.joinToGroupFailed()})}}}).factory("GROUP_EVENTS",function(e){return{joinToGroupSuccess:function(){e.push("success","Groupa została pomyślnie dodana!")},joinToGroupFailed:function(){e.push("error","Coś poszło nie tak. Spróbuj ponownie!")}}}),angular.module("users").factory("AUTH_SERVICE",function(e,t,o,n,r){return{signIn:function(s){return e.post(n.auth.signIn,s).then(function(e){var n=e.data.token;o.localStorage.setItem("token",n),r.signInSuccess(),t.go("home")},function(e){r.signInFailed(e.data.status)})},signUp:function(o){return e.post(n.auth.signUp,o).then(function(){r.signUpSuccess(),t.go("auth.signin")},function(e){r.signUpFailed(e.data.status)})}}}).factory("AUTH_EVENTS",function(e){return{signInSuccess:function(){e.push("success","Pomyślnie zalogowano. Witamy na spotted!")},signInFailed:function(t){switch(t){case 1401:e.push("error","Wprowadzone dane są niepoprawne. Spróbuj ponownie!");break;default:e.push("error","Coś poszło nie tak. Spróbuj ponownie!")}},signUpSuccess:function(){e.push("success","Konto zostało utworzone. Możesz teraz się zalogować!")},signUpFailed:function(t){switch(t){case 1402:e.push("error","Podany e-mail jest już przypisany do konta spotted!");break;default:e.push("error","Coś poszło nie tak. Spróbuj ponownie!")}}}}),angular.module("users").factory("USER_SERVICE",function(e,t,o,n,r,s,u){return{getCurrentUser:function(){return e({url:o.users+"/"+n.user.id,method:"GET",headers:{"x-access-token":n.token}}).then(function(e){return e.data})},getUserPosts:function(t){return e({url:o.posts+"/user/"+t,method:"GET",headers:{"x-access-token":n.token}}).then(function(e){return e.data})},getUserGroups:function(){return e({url:o.users+"/"+n.user.id+"/group",method:"GET",headers:{"x-access-token":n.token}}).then(function(e){return e.data})},changePassword:function(u){e({url:o.users+"/"+n.user.id+"/password",method:"POST",data:{password:u.password,newPassword:u.newPassword},headers:{"x-access-token":n.token}}).then(function(){s.changePasswordSuccess(),t.localStorage.removeItem("token"),n.user=!1,r.go("auth.signin")},function(e){s.changePasswordFailed(e.data.status)})},changePicture:function(e){u.upload({url:o.users+"/"+n.user.id+"/picture",data:{image:e.picture},headers:{"x-access-token":n.token}}).then(function(){s.changePictureSuccess(),r.reload()},function(){s.changePictureFailed()})}}}).factory("USER_EVENTS",function(e){return{changePasswordSuccess:function(){e.push("success","Hasło zostało zmienione. Zaloguj się ponownie!")},changePasswordFailed:function(t){switch(t){case 1401:e.push("error","Aktualne hasło jest nie poprawne. Spróbuj ponownie!");break;default:e.push("error","Coś poszło nie tak. Spróbuj ponownie!")}},changePictureSuccess:function(){e.push("success","Twoje zdjęcie zostało zmienione.")},changePictureFailed:function(){e.push("error","Coś poszło nie tak. Spróbuj ponownie!")}}}),angular.module("core").config(["$stateProvider",function(e){e.state("home",{url:"/",templateUrl:"app/modules/core/client/views/home/home.client.view.html"})}]),angular.module("users").config(["$stateProvider",function(e){e.state("groups",{url:"/groups",templateUrl:"app/modules/groups/client/views/groups.client.view.html",controller:"groupsController"})}]),angular.module("users").config(["$stateProvider",function(e){e.state("auth",{"abstract":!0,templateUrl:"app/modules/users/client/views/auth/auth.client.view.html",controller:"authController",access:{guest:!0,user:!1}}).state("auth.signin",{url:"/signin",templateUrl:"app/modules/users/client/views/auth/signin/signin.client.view.html",controller:"authSigninController",access:{guest:!0,user:!1}}).state("auth.signup",{url:"/signup",templateUrl:"app/modules/users/client/views/auth/signup/signup.client.view.html",controller:"authSignupController",access:{guest:!0,user:!1}})}]),angular.module("users").config(["$stateProvider",function(e){e.state("user",{"abstract":!0,templateUrl:"app/modules/users/client/views/user/user.client.view.html",controller:"userController"}).state("user.posts",{url:"/user/posts",templateUrl:"app/modules/users/client/views/user/posts/posts.client.view.html",controller:"userPostsController",access:{guest:!1,user:!0}}).state("user.groups",{url:"/user/groups",templateUrl:"app/modules/users/client/views/user/groups/groups.client.view.html",controller:"userGroupsController",access:{guest:!1,user:!0}}).state("user.settings",{url:"/user/settings",templateUrl:"app/modules/users/client/views/user/settings/settings.client.view.html",controller:"userSettingsController",access:{guest:!1,user:!0}})}]),angular.module("posts").controller("commentsPostsController",function(e,t){e.comments=[],e.data={},e.limitTo=3,e.noMoreComments=!0,e.showMoreComments=function(){e.limitTo=e.limitTo+3,e.limitTo>=e.comments.length&&(e.noMoreComments=!0)},e.getComments=function(o){t.getComments(o).then(function(t){e.comments=t,e.comments.length>3&&e.limitTo<=e.comments.length?e.noMoreComments=!1:e.noMoreComments=!0})},e.createComment=function(o,n){t.createComment(o,n).then(function(){e.getComments(o),e.data.message=""})},e.deleteComment=function(o,n){t.deleteComment(o).then(function(){e.getComments(n)})}}),angular.module("posts").controller("postsController",function(e,t){e.getPosts=function(){t.getPosts().then(function(t){e.posts=t})}}).controller("createPostsController",function(e,t){e.openCreatePost=function(){e.activeCreatePost=!0},e.closeCreatePost=function(){e.activeCreatePost=!1},e.data={picture:null},e.removePicture=function(){e.data.picture=null},e.getGroupsByName=function(e){return t.getGroupsByName(e).then(function(e){return e})},e.createPost=function(o){null==o.picture?t.createPost(o).then(function(){e.data={},e.getPosts(),e.closeCreatePost()}):t.createPostUpload(o).then(function(){e.data={},e.getPosts(),e.closeCreatePost()})}}),angular.module("core").controller("coreController",function(e,t,o){}).controller("headerController",["$scope","$state","$window","$rootScope",function(e,t,o,n){e.signout=function(){o.localStorage.removeItem("token"),n.user=!1,n.alerts={success:"Poprawnie wylogowano z serwisu spotted. Zapraszamy ponownie!"},t.go("home")}}]),angular.module("groups").controller("groupsController",function(e,t){t.getGroups().then(function(t){e.groups=t}),e.joinToGroup=function(e){t.joinToGroup(e).then()}}),angular.module("users").controller("authController",["$scope",function(e){e.credentials={email:"",password:""}}]).controller("authSigninController",function(e,t,o){e.signIn=function(t){o.signIn(t).then(function(){e.credentials.password=""})}}).controller("authSignupController",function(e,t,o){e.signUp=function(t){o.signUp(t).then(function(){e.credentials={}})}}),angular.module("users").controller("userController",function(e,t){t.getCurrentUser().then(function(t){e.currentUser=t})}).controller("userPostsController",function(e,t){e.getUserPosts=function(o){t.getUserPosts(o).then(function(t){e.userPosts=t,console.log(t)})}}).controller("userGroupsController",function(e,t){t.getUserGroups().then(function(t){e.userGroups=t})}).controller("userSettingsController",function(e,t){e.changePassword=function(e){t.changePassword(e)},e.changePicture=function(e){t.changePicture(e)}});