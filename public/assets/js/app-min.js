"use strict";var ApplicationConfiguration=function(){var e="spotted",t=["ui.router","angular-jwt"],o=function(t,o){angular.module(t,o||[]),angular.module(e).requires.push(t)};return{applicationModuleName:e,applicationModuleVendorDependencies:t,registerModule:o}}();angular.module(ApplicationConfiguration.applicationModuleName,ApplicationConfiguration.applicationModuleVendorDependencies),angular.module(ApplicationConfiguration.applicationModuleName).config(["$locationProvider",function(e){e.html5Mode(!0).hashPrefix("!")}]),angular.element(document).ready(function(){"#_=_"===window.location.hash&&(window.location.hash="#!"),angular.bootstrap(document,[ApplicationConfiguration.applicationModuleName])}),angular.module(ApplicationConfiguration.applicationModuleName).config(function(e,t){t.tokenGetter=function(){return localStorage.getItem("token")},e.interceptors.push("jwtInterceptor")}).run(function(e,t,o){t.$on("$stateChangeStart",function(t,n){n.access&&n.access.guest?o.localStorage.getItem("token")&&(t.preventDefault(),e.go("home")):n.access&&n.access.user&&(o.localStorage.getItem("token")||(t.preventDefault(),e.go("login")))})}).factory("userService",function(e){var t=localStorage.getItem("token");if(t){var o=t&&e.decodeToken(t);return{user:o.user}}return{user:""}}),ApplicationConfiguration.registerModule("core"),ApplicationConfiguration.registerModule("users"),angular.module("users").factory("usersFactory",function(){return{api:{login:"api/v1/auth/signin",register:"api/v1/auth/signup"}}}),angular.module("core").config(["$stateProvider","$urlRouterProvider",function(e,t){t.otherwise("404"),e.state("home",{url:"/",templateUrl:"app/modules/core/client/views/home/home.client.view.html"}).state("404",{url:"/404",templateUrl:"app/modules/core/client/views/error/404.client.view.html"})}]),angular.module("users").config(["$stateProvider",function(e){e.state("authentication",{"abstract":!0,templateUrl:"app/modules/users/client/views/authentication/authentication.client.view.html",access:{guest:!0,user:!1}}).state("authentication.signin",{url:"/signin",templateUrl:"app/modules/users/client/views/authentication/signin/signin.client.view.html",access:{guest:!0,user:!1}}).state("authentication.signup",{url:"/signup",templateUrl:"app/modules/users/client/views/authentication/signup/signup.client.view.html",access:{guest:!0,user:!1}})}]),angular.module("core").controller("headerController",["$scope","userService","$window","$state",function(e,t,o,n){e.user=t.user,e.logout=function(){o.localStorage.removeItem("token"),e.user=!1}}]),angular.module("users").controller("signinController",["$scope","$http","usersFactory","$window","$state",function(e,t,o,n,i){e.signin=function(){t({url:o.api.login,method:"POST",data:e.user}).then(function(t){var o=t.data.status;200===o?(n.localStorage.setItem("token",t.data.token),e.user=t.user,i.go("home")):401===o&&(e.error="Adres e-mail lub hasło są nieprawidłowe!")})}}]).controller("signupController",["$scope","$http","usersFactory","$state",function(e,t,o,n){e.signup=function(){t({url:o.api.register,method:"POST",data:e.user}).then(function(t){console.log(e.user);var o=t.data.status;200===o?n.go("authentication.signin"):409===o&&(e.error="Do podanego adresu e-mail jest już przypisane konto użytkownika w naszym serwisie!")})}}]);